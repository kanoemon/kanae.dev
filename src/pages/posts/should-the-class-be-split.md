---
layout: ../../layouts/PostLayout.astro
title: そのクラスは分割すべきか？
slug: should-the-class-be-split
pubDate: 2023-09-10T04:17:48.155Z
tags:
  - 設計
thumbnail: /assets/images/posts/should-the-class-be-split.png
---

コードレビューで巨大なクラスを発見した時に、そのクラスを分割できる余地があるかコメントすることがある。その際に、そのクラスを分割するべきかどうかについての意見が一致しないことがたびたびある。

## 意見の対立
自分「このクラスは大きすぎる。分割した方が良い。」    
相手:「このクラスは1つの責務を果たしてる。分割は不要だと思う。」

だいたいこんな感じ。

## 議論の焦点
この時の議論の焦点となったクラスは、データベースから一括でデータを取得し、それを加工して返すようなクラスである。このクラスは特定のデータを処理するクラスとみなせるため、1つの責務を持つクラスとも言えるという意見も確かにな〜と思っていた。

## 意見の食い違いの原因
最近「<a href="https://www.amazon.co.jp/Good-Code-Bad-%EF%BD%9E%E6%8C%81%E7%B6%9A%E5%8F%AF%E8%83%BD%E3%81%AA%E9%96%8B%E7%99%BA%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E7%9A%84%E6%80%9D%E8%80%83/dp/4798068160" target="_blank">Good Code, Bad Code</a>」の本を読んでいた際に、同様の問題について触れられているのを見つけた。意見の相違は、「関連する小さな問題を個別に解決するか、それらをメインの問題の本質的な一部として捉えるか」という違いからだと書かれていた。

なるほど、関連している問題を見ている観点が違っていたのか。ということと、自分も相手も「クラスは1つのことに関心を持つべき」という考え方は一致していることも本を読んでいく中で整理ができた。

## どの観点からクラスを見るべきか
そのクラスがどれくらいの問題を抱えるべきか、という点は主観も入ってくるため判断が難しい。

同書では、コード品質の6つの柱を紹介している。以下の観点を考慮して、巨大なクラスがこの柱に当てはまっているか、低品質なコードを特定できるかどうかを検討すべきであると書かれている。

1. コードを読みやすくする
2. 想定外の事態をなくす
3. 誤用しにくいコードを書く
4. コードをモジュール化する
5. コードを再利用、汎用化しやすくする
6. テストしやすいコードを書き、適切にテストする

## より良いクラスを作るためにできること
巨大なクラスの場合、1つのクラスが多くの問題を解決しようとしているため、コードの理解に時間がかかり、認知的な負担が増大する。これが自分が巨大なクラスを見たときに感じた「わかりづらさ」につながっている。

クラスの行数が多いだけで単純に分割すべきというわけでもないと思う。ただ、行数が多いクラスはそれだけ多くの問題に対処する必要があることではある。巨大なクラスを発見した場合や自分が新たに書こうとしている場合には、そのクラスが過度に多くの問題を抱えすぎていないかどうかを考慮する習慣を持っておきたいなと改めて思った。
